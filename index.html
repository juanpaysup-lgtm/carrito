<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Dibujo T√©cnico - Eco-Torky</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: #1e2a3a;
            color: #ecf0f1;
            overflow: hidden;
            height: 100vh;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }
        
        /* Panel de herramientas */
        .toolbar {
            width: 300px;
            background: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #3498db;
            overflow-y: auto;
        }
        
        .tool-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #34495e;
            border-radius: 8px;
        }
        
        .tool-section h3 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 16px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .tool-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .tool-btn {
            background: #4a6572;
            border: 2px solid #5d7a8c;
            color: #ecf0f1;
            padding: 12px 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 12px;
        }
        
        .tool-btn:hover {
            background: #556f7c;
            transform: translateY(-2px);
            border-color: #3498db;
        }
        
        .tool-btn.active {
            background: #3498db;
            color: white;
            border-color: #2980b9;
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .update-btn {
            background: #2ecc71;
            color: white;
        }
        
        .update-btn:hover {
            background: #27ae60;
        }
        
        .save-btn {
            background: #9b59b6;
            color: white;
        }
        
        .save-btn:hover {
            background: #8e44ad;
        }
        
        .measurement-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .input-group label {
            min-width: 80px;
            font-size: 12px;
            color: #bdc3c7;
        }
        
        .measurement-input {
            background: #4a6572;
            border: 1px solid #5d7a8c;
            color: #ecf0f1;
            padding: 8px;
            border-radius: 4px;
            width: 100px;
            font-size: 12px;
        }
        
        .measurement-input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .color-picker {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            border-color: #ecf0f1;
            transform: scale(1.1);
        }
        
        .preset-measurements {
            background: #4a6572;
            border-radius: 6px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .preset-item {
            padding: 8px;
            margin: 5px 0;
            background: #5d7a8c;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.3s;
        }
        
        .preset-item:hover {
            background: #6b8a9e;
        }
        
        /* √Årea de dibujo */
        .drawing-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #2c3e50;
            border-radius: 10px;
            border: 2px solid #3498db;
            overflow: hidden;
        }
        
        .drawing-controls {
            background: #34495e;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #3498db;
        }
        
        .scale-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-btn {
            background: #3498db;
            border: none;
            color: #ecf0f1;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .control-btn:hover {
            background: #2980b9;
        }
        
        .canvas-container {
            flex: 1;
            overflow: auto;
            padding: 20px;
            position: relative;
            background: #1a252f;
        }
        
        #drawing-canvas {
            background: #1a252f;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            cursor: crosshair;
            display: block;
        }
        
        .grid-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            pointer-events: none;
            opacity: 0.3;
        }
        
        .status-bar {
            background: #34495e;
            padding: 10px 20px;
            border-top: 1px solid #4a6572;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }
        
        /* Modal de ayuda */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #34495e;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid #3498db;
        }
        
        .modal h2 {
            color: #3498db;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }
        
        .close-modal:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Panel de herramientas -->
        <div class="toolbar">
            <div class="tool-section">
                <h3>Herramientas de Dibujo</h3>
                <div class="tool-buttons">
                    <button class="tool-btn active" data-tool="select">Seleccionar</button>
                    <button class="tool-btn" data-tool="rectangle">Rect√°ngulo</button>
                    <button class="tool-btn" data-tool="circle">C√≠rculo</button>
                    <button class="tool-btn" data-tool="line">L√≠nea</button>
                    <button class="tool-btn" data-tool="text">Texto</button>
                    <button class="tool-btn" data-tool="dimension">Medir</button>
                </div>
            </div>
            
            <div class="tool-section">
                <h3>Medidas (cm)</h3>
                <div class="measurement-inputs">
                    <div class="input-group">
                        <label>Largo:</label>
                        <input type="number" class="measurement-input" id="length-input" value="215" min="1">
                    </div>
                    <div class="input-group">
                        <label>Ancho:</label>
                        <input type="number" class="measurement-input" id="width-input" value="90" min="1">
                    </div>
                    <div class="input-group">
                        <label>Alto:</label>
                        <input type="number" class="measurement-input" id="height-input" value="155" min="1">
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn update-btn" id="update-btn">Actualizar</button>
                    <button class="action-btn save-btn" id="save-btn">Guardar</button>
                </div>
                
                <div class="preset-measurements">
                    <div class="preset-item" data-length="215" data-width="90" data-height="155">üöó Veh√≠culo Completo</div>
                    <div class="preset-item" data-length="48" data-width="75" data-height="40">üí∫ Asiento Individual</div>
                    <div class="preset-item" data-length="78" data-width="75" data-height="35">üì¶ Caj√≥n de Carga</div>
                    <div class="preset-item" data-length="50" data-width="50" data-height="50">‚ö™ Rueda</div>
                </div>
            </div>
            
            <div class="tool-section">
                <h3>Colores</h3>
                <div class="color-picker">
                    <div class="color-option active" style="background:#3498db" data-color="#3498db"></div>
                    <div class="color-option" style="background:#e74c3c" data-color="#e74c3c"></div>
                    <div class="color-option" style="background:#2ecc71" data-color="#2ecc71"></div>
                    <div class="color-option" style="background:#f1c40f" data-color="#f1c40f"></div>
                    <div class="color-option" style="background:#9b59b6" data-color="#9b59b6"></div>
                    <div class="color-option" style="background:#1abc9c" data-color="#1abc9c"></div>
                    <div class="color-option" style="background:#e67e22" data-color="#e67e22"></div>
                    <div class="color-option" style="background:#95a5a6" data-color="#95a5a6"></div>
                    <div class="color-option" style="background:#ecf0f1" data-color="#ecf0f1"></div>
                </div>
            </div>
            
            <div class="tool-section">
                <h3>Acciones</h3>
                <div class="tool-buttons">
                    <button class="tool-btn" id="clear-btn">Limpiar Todo</button>
                    <button class="tool-btn" id="grid-toggle">Cuadr√≠cula: ON</button>
                    <button class="tool-btn" id="help-btn">Ayuda</button>
                    <button class="tool-btn" id="draw-reference">Dibujo Ref.</button>
                </div>
            </div>
        </div>
        
        <!-- √Årea de dibujo -->
        <div class="drawing-area">
            <div class="drawing-controls">
                <div class="scale-controls">
                    <button class="control-btn" id="zoom-out">‚àí</button>
                    <span id="zoom-level" style="min-width: 50px; text-align: center;">100%</span>
                    <button class="control-btn" id="zoom-in">+</button>
                    <button class="control-btn" id="fit-to-screen">Ajustar</button>
                </div>
                
                <div style="font-size: 12px;">
                    <span id="cursor-position">X: 0cm, Y: 0cm</span>
                </div>
                
                <div style="font-size: 12px; color: #3498db;">
                    <strong>Escala: 1:10 | 1 cuadro = 1cm</strong>
                </div>
            </div>
            
            <div class="canvas-container">
                <canvas id="drawing-canvas" width="2600" height="2600"></canvas>
                <canvas class="grid-overlay" id="grid-canvas" width="2600" height="2600"></canvas>
            </div>
            
            <div class="status-bar">
                <span id="selected-tool">Herramienta: Seleccionar</span>
                <span id="measurement-info">Medidas: 215√ó90√ó155 cm</span>
                <span id="element-count">Elementos: 0</span>
            </div>
        </div>
    </div>
    
    <!-- Modal de ayuda -->
    <div class="modal" id="help-modal">
        <div class="modal-content">
            <h2>üéØ Ayuda - App de Dibujo T√©cnico</h2>
            <h3>üìã C√≥mo usar:</h3>
            <ul style="margin-bottom: 20px; line-height: 1.6;">
                <li><strong>1.</strong> Selecciona una herramienta del panel izquierdo</li>
                <li><strong>2.</strong> Establece las medidas en cent√≠metros</li>
                <li><strong>3.</strong> Haz clic y arrastra en el √°rea de dibujo para crear formas</li>
                <li><strong>4.</strong> Cada cuadro de la cuadr√≠cula representa 1cm a escala 1:10</li>
                <li><strong>5.</strong> Usa los presets para medidas comunes del Eco-Torky</li>
                <li><strong>6.</strong> Usa "Actualizar" para aplicar cambios de medidas</li>
                <li><strong>7.</strong> Usa "Dibujo Ref." para ver el veh√≠culo completo</li>
            </ul>
            
            <h3>‚å®Ô∏è Atajos de teclado:</h3>
            <ul style="margin-bottom: 20px; line-height: 1.6;">
                <li><strong>R:</strong> Rect√°ngulo</li>
                <li><strong>C:</strong> C√≠rculo</li>
                <li><strong>L:</strong> L√≠nea</li>
                <li><strong>T:</strong> Texto</li>
                <li><strong>M:</strong> Medir</li>
                <li><strong>Delete:</strong> Eliminar elemento seleccionado</li>
                <li><strong>Ctrl+Z:</strong> Deshacer</li>
            </ul>
            
            <button class="close-modal" id="close-help">Cerrar Ayuda</button>
        </div>
    </div>

    <script>
        // Configuraci√≥n inicial
        const canvas = document.getElementById('drawing-canvas');
        const ctx = canvas.getContext('2d');
        const gridCanvas = document.getElementById('grid-canvas');
        const gridCtx = gridCanvas.getContext('2d');
        
        // Estado de la aplicaci√≥n
        let currentTool = 'select';
        let isDrawing = false;
        let startX, startY;
        let currentColor = '#3498db';
        let scale = 1;
        let gridEnabled = true;
        
        // Medidas actuales
        let currentLength = 215;
        let currentWidth = 90;
        let currentHeight = 155;
        
        // Elementos dibujados
        const elements = [];
        let selectedElement = null;
        
        // Inicializar la cuadr√≠cula
        function drawGrid() {
            gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);
            
            if (!gridEnabled) return;
            
            const gridSize = 10; // 1cm = 10px a escala 1:10
            
            // L√≠neas principales cada 10cm
            gridCtx.strokeStyle = '#3498db';
            gridCtx.lineWidth = 0.5;
            
            for (let x = 0; x <= gridCanvas.width; x += gridSize * 10) {
                gridCtx.beginPath();
                gridCtx.moveTo(x, 0);
                gridCtx.lineTo(x, gridCanvas.height);
                gridCtx.stroke();
            }
            
            for (let y = 0; y <= gridCanvas.height; y += gridSize * 10) {
                gridCtx.beginPath();
                gridCtx.moveTo(0, y);
                gridCtx.lineTo(gridCanvas.width, y);
                gridCtx.stroke();
            }
            
            // L√≠neas secundarias cada 1cm
            gridCtx.strokeStyle = '#4a6572';
            gridCtx.lineWidth = 0.3;
            
            for (let x = 0; x <= gridCanvas.width; x += gridSize) {
                gridCtx.beginPath();
                gridCtx.moveTo(x, 0);
                gridCtx.lineTo(x, gridCanvas.height);
                gridCtx.stroke();
            }
            
            for (let y = 0; y <= gridCanvas.height; y += gridSize) {
                gridCtx.beginPath();
                gridCtx.moveTo(0, y);
                gridCtx.lineTo(gridCanvas.width, y);
                gridCtx.stroke();
            }
        }
        
        // Dibujar todos los elementos
        function drawElements() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            elements.forEach(element => {
                ctx.save();
                
                // Configuraci√≥n para elemento seleccionado
                if (element === selectedElement) {
                    ctx.strokeStyle = '#f1c40f';
                    ctx.lineWidth = 3;
                    ctx.setLineDash([5, 5]);
                } else {
                    ctx.strokeStyle = element.color;
                    ctx.lineWidth = 2;
                    ctx.setLineDash([]);
                }
                
                ctx.fillStyle = element.color + '40'; // Color con transparencia
                
                switch (element.type) {
                    case 'rectangle':
                        ctx.fillRect(element.x, element.y, element.width, element.height);
                        ctx.strokeRect(element.x, element.y, element.width, element.height);
                        
                        // Etiqueta de medidas
                        ctx.fillStyle = element.color;
                        ctx.font = '12px Arial';
                        ctx.fillText(
                            `${element.width/10}√ó${element.height/10}cm`, 
                            element.x + 5, 
                            element.y + 15
                        );
                        break;
                    
                    case 'circle':
                        ctx.beginPath();
                        ctx.arc(element.x, element.y, element.radius, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.stroke();
                        
                        // Etiqueta de radio
                        ctx.fillStyle = element.color;
                        ctx.font = '12px Arial';
                        ctx.fillText(
                            `‚åÄ${(element.radius * 2/10).toFixed(1)}cm`, 
                            element.x - 20, 
                            element.y - 10
                        );
                        break;
                    
                    case 'line':
                        ctx.beginPath();
                        ctx.moveTo(element.x1, element.y1);
                        ctx.lineTo(element.x2, element.y2);
                        ctx.stroke();
                        break;
                    
                    case 'text':
                        ctx.fillStyle = element.color;
                        ctx.font = '14px Arial';
                        ctx.fillText(element.text, element.x, element.y);
                        break;
                    
                    case 'dimension':
                        ctx.strokeStyle = '#95a5a6';
                        ctx.setLineDash([5, 3]);
                        ctx.lineWidth = 1;
                        
                        // L√≠nea de dimensi√≥n
                        ctx.beginPath();
                        ctx.moveTo(element.x1, element.y1);
                        ctx.lineTo(element.x2, element.y2);
                        ctx.stroke();
                        
                        // Texto de dimensi√≥n
                        ctx.fillStyle = '#ecf0f1';
                        ctx.font = '12px Arial';
                        ctx.fillText(
                            element.value + ' cm', 
                            (element.x1 + element.x2) / 2 - 15, 
                            (element.y1 + element.y2) / 2 - 5
                        );
                        break;
                }
                
                ctx.restore();
            });
            
            updateElementCount();
        }
        
        // Dibujar referencia del veh√≠culo completo
        function drawVehicleReference() {
            // Limpiar elementos existentes
            elements.length = 0;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // Chasis principal
            elements.push({
                type: 'rectangle',
                x: centerX - (currentLength * 5),
                y: centerY - (currentWidth * 5),
                width: currentLength * 10,
                height: currentWidth * 10,
                color: '#3498db'
            });
            
            // Asientos frontales
            elements.push({
                type: 'rectangle',
                x: centerX - (currentLength * 4),
                y: centerY - (currentWidth * 4),
                width: 48 * 10,
                height: 75 * 10,
                color: '#2ecc71'
            });
            
            // Caj√≥n de carga
            elements.push({
                type: 'rectangle',
                x: centerX,
                y: centerY - (currentWidth * 4),
                width: 78 * 10,
                height: 75 * 10,
                color: '#9b59b6'
            });
            
            // Ruedas
            const wheelRadius = 25 * 10; // 25cm de radio
            elements.push({
                type: 'circle',
                x: centerX - (currentLength * 4),
                y: centerY - (currentWidth * 4.5),
                radius: wheelRadius,
                color: '#e74c3c'
            });
            
            elements.push({
                type: 'circle',
                x: centerX - (currentLength * 4),
                y: centerY + (currentWidth * 4.5),
                radius: wheelRadius,
                color: '#e74c3c'
            });
            
            elements.push({
                type: 'circle',
                x: centerX + (currentLength * 4),
                y: centerY - (currentWidth * 4.5),
                radius: wheelRadius,
                color: '#e74c3c'
            });
            
            elements.push({
                type: 'circle',
                x: centerX + (currentLength * 4),
                y: centerY + (currentWidth * 4.5),
                radius: wheelRadius,
                color: '#e74c3c'
            });
            
            drawElements();
        }
        
        // Event Listeners para herramientas
        document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tool-btn[data-tool]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentTool = this.dataset.tool;
                updateStatus();
            });
        });
        
        // Event Listeners para colores
        document.querySelectorAll('.color-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.color-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                currentColor = this.dataset.color;
            });
        });
        
        // Event Listeners para presets
        document.querySelectorAll('.preset-item').forEach(item => {
            item.addEventListener('click', function() {
                document.getElementById('length-input').value = this.dataset.length;
                document.getElementById('width-input').value = this.dataset.width;
                document.getElementById('height-input').value = this.dataset.height;
                
                currentLength = parseInt(this.dataset.length);
                currentWidth = parseInt(this.dataset.width);
                currentHeight = parseInt(this.dataset.height);
                
                updateStatus();
                
                // Si es el veh√≠culo completo, dibujar referencia
                if (this.dataset.length === "215") {
                    drawVehicleReference();
                }
            });
        });
        
        // Bot√≥n Actualizar
        document.getElementById('update-btn').addEventListener('click', function() {
            currentLength = parseInt(document.getElementById('length-input').value) || 215;
            currentWidth = parseInt(document.getElementById('width-input').value) || 90;
            currentHeight = parseInt(document.getElementById('height-input').value) || 155;
            
            updateStatus();
            drawElements();
        });
        
        // Bot√≥n Guardar
        document.getElementById('save-btn').addEventListener('click', function() {
            const link = document.createElement('a');
            link.download = 'eco-torky-plano.png';
            link.href = canvas.toDataURL();
            link.click();
            alert('‚úÖ Plano guardado como eco-torky-plano.png');
        });
        
        // Bot√≥n Dibujo Referencia
        document.getElementById('draw-reference').addEventListener('click', function() {
            drawVehicleReference();
        });
        
        // Controles de zoom
        document.getElementById('zoom-in').addEventListener('click', function() {
            scale = Math.min(scale + 0.1, 3);
            updateZoom();
        });
        
        document.getElementById('zoom-out').addEventListener('click', function() {
            scale = Math.max(scale - 0.1, 0.3);
            updateZoom();
        });
        
        document.getElementById('fit-to-screen').addEventListener('click', function() {
            scale = 1;
            updateZoom();
        });
        
        // Cuadr√≠cula
        document.getElementById('grid-toggle').addEventListener('click', function() {
            gridEnabled = !gridEnabled;
            this.textContent = gridEnabled ? 'Cuadr√≠cula: ON' : 'Cuadr√≠cula: OFF';
            drawGrid();
        });
        
        // Limpiar canvas
        document.getElementById('clear-btn').addEventListener('click', function() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todo el dibujo?')) {
                elements.length = 0;
                selectedElement = null;
                drawElements();
            }
        });
        
        // Ayuda
        document.getElementById('help-btn').addEventListener('click', function() {
            document.getElementById('help-modal').style.display = 'flex';
        });
        
        document.getElementById('close-help').addEventListener('click', function() {
            document.getElementById('help-modal').style.display = 'none';
        });
        
        // Eventos del canvas
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        // Seguimiento del cursor
        canvas.addEventListener('mousemove', function(e) {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) / scale;
            const y = (e.clientY - rect.top) / scale;
            document.getElementById('cursor-position').textContent = 
                `X: ${Math.round(x/10)}cm, Y: ${Math.round(y/10)}cm`;
        });
        
        function startDrawing(e) {
            const rect = canvas.getBoundingClientRect();
            startX = (e.clientX - rect.left) / scale;
            startY = (e.clientY - rect.top) / scale;
            
            if (currentTool === 'select') {
                // Buscar elemento bajo el cursor
                selectedElement = null;
                for (let i = elements.length - 1; i >= 0; i--) {
                    const element = elements[i];
                    if (isPointInElement(startX, startY, element)) {
                        selectedElement = element;
                        break;
                    }
                }
                drawElements();
                return;
            }
            
            isDrawing = true;
        }
        
        function draw(e) {
            if (!isDrawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const currentX = (e.clientX - rect.left) / scale;
            const currentY = (e.clientY - rect.top) / scale;
            
            // Dibujar preview temporal
            drawElements();
            ctx.save();
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 3]);
            ctx.globalAlpha = 0.7;
            
            switch (currentTool) {
                case 'rectangle':
                    const width = currentX - startX;
                    const height = currentY - startY;
                    ctx.strokeRect(startX, startY, width, height);
                    break;
                
                case 'circle':
                    const radius = Math.sqrt(Math.pow(currentX - startX, 2) + Math.pow(currentY - startY, 2));
                    ctx.beginPath();
                    ctx.arc(startX, startY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                    break;
                
                case 'line':
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(currentX, currentY);
                    ctx.stroke();
                    break;
            }
            
            ctx.restore();
        }
        
        function stopDrawing(e) {
            if (!isDrawing) return;
            
            isDrawing = false;
            const rect = canvas.getBoundingClientRect();
            const endX = (e.clientX - rect.left) / scale;
            const endY = (e.clientY - rect.top) / scale;
            
            let newElement = null;
            
            switch (currentTool) {
                case 'rectangle':
                    newElement = {
                        type: 'rectangle',
                        x: startX,
                        y: startY,
                        width: endX - startX,
                        height: endY - startY,
                        color: currentColor
                    };
                    break;
                
                case 'circle':
                    const radius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                    newElement = {
                        type: 'circle',
                        x: startX,
                        y: startY,
                        radius: radius,
                        color: currentColor
                    };
                    break;
                
                case 'line':
                    newElement = {
                        type: 'line',
                        x1: startX,
                        y1: startY,
                        x2: endX,
                        y2: endY,
                        color: currentColor
                    };
                    break;
                
                case 'text':
                    const text = prompt('Ingresa el texto:');
                    if (text) {
                        newElement = {
                            type: 'text',
                            x: startX,
                            y: startY,
                            text: text,
                            color: currentColor
                        };
                    }
                    break;
                
                case 'dimension':
                    const distance = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                    const realDistance = (distance / 10).toFixed(1); // Convertir a cm
                    newElement = {
                        type: 'dimension',
                        x1: startX,
                        y1: startY,
                        x2: endX,
                        y2: endY,
                        value: realDistance,
                        color: currentColor
                    };
                    break;
            }
            
            if (newElement) {
                elements.push(newElement);
                drawElements();
            }
        }
        
        function isPointInElement(x, y, element) {
            switch (element.type) {
                case 'rectangle':
                    return x >= element.x && x <= element.x + element.width &&
                           y >= element.y && y <= element.y + element.height;
                
                case 'circle':
                    return Math.sqrt(Math.pow(x - element.x, 2) + Math.pow(y - element.y, 2)) <= element.radius;
                
                case 'line':
                    const distance = pointToLineDistance(x, y, element.x1, element.y1, element.x2, element.y2);
                    return distance < 8;
                
                default:
                    return false;
            }
        }
        
        function pointToLineDistance(x, y, x1, y1, x2, y2) {
            const A = x - x1;
            const B = y - y1;
            const C = x2 - x1;
            const D = y2 - y1;
            
            const dot = A * C + B * D;
            const lenSq = C * C + D * D;
            let param = -1;
            
            if (lenSq !== 0) param = dot / lenSq;
            
            let xx, yy;
            
            if (param < 0) {
                xx = x1;
                yy = y1;
            } else if (param > 1) {
                xx = x2;
                yy = y2;
            } else {
                xx = x1 + param * C;
                yy = y1 + param * D;
            }
            
            const dx = x - xx;
            const dy = y - yy;
            return Math.sqrt(dx * dx + dy * dy);
        }
        
        function updateZoom() {
            canvas.style.transform = `scale(${scale})`;
            gridCanvas.style.transform = `scale(${scale})`;
            document.getElementById('zoom-level').textContent = Math.round(scale * 100) + '%';
        }
        
        function updateStatus() {
            document.getElementById('selected-tool').textContent = `Herramienta: ${getToolName(currentTool)}`;
            document.getElementById('measurement-info').textContent = 
                `Medidas: ${currentLength}√ó${currentWidth}√ó${currentHeight} cm`;
        }
        
        function updateElementCount() {
            document.getElementById('element-count').textContent = `Elementos: ${elements.length}`;
        }
        
        function getToolName(tool) {
            const names = {
                'select': 'Seleccionar',
                'rectangle': 'Rect√°ngulo',
                'circle': 'C√≠rculo',
                'line': 'L√≠nea',
                'text': 'Texto',
                'dimension': 'Medir'
            };
            return names[tool] || tool;
        }
        
        // Inicializar aplicaci√≥n
        function initApp() {
            drawGrid();
            drawElements();
            updateStatus();
            updateZoom();
            
            console.log('‚úÖ App de dibujo t√©cnico inicializada correctamente');
            console.log('üìê Canvas: 2600x2600 px (260x260 cm)');
            console.log('üöó Veh√≠culo completo: 215√ó90√ó155 cm');
        }
        
        // Atajos de teclado
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT') return;
            
            switch (e.key.toLowerCase()) {
                case 'r':
                    document.querySelector('[data-tool="rectangle"]').click();
                    break;
                case 'c':
                    document.querySelector('[data-tool="circle"]').click();
                    break;
                case 'l':
                    document.querySelector('[data-tool="line"]').click();
                    break;
                case 't':
                    document.querySelector('[data-tool="text"]').click();
                    break;
                case 'm':
                    document.querySelector('[data-tool="dimension"]').click();
                    break;
                case 'delete':
                    if (selectedElement) {
                        const index = elements.indexOf(selectedElement);
                        if (index > -1) {
                            elements.splice(index, 1);
                            selectedElement = null;
                            drawElements();
                        }
                    }
                    break;
            }
            
            if (e.ctrlKey && e.key === 'z') {
                if (elements.length > 0) {
                    elements.pop();
                    drawElements();
                }
            }
        });
        
        // Inicializar cuando se carga la p√°gina
        window.addEventListener('load', initApp);
    </script>
</body>
</html>